!function(){"use strict";var e={};e.Router=class{routes=[];root="/";before;page404;constructor(e){e?.root&&(this.root="/"===e.root?"/":"/"+this.trimSlashes(e.root)+"/"),"function"==typeof e?.before&&(this.before=e.before),"function"==typeof e?.page404&&(this.page404=e.page404),e?.routes?.length>0&&e.routes.forEach((e=>{this.add(e.rule,e.handler,e.options)}))}get fragment(){let e=decodeURI(location.pathname);return"/"!==this.root&&(e=e.replace(this.root,"")),this.trimSlashes(e)}get query(){return this.parseQuery(location.search)}add(e,t,r){return this.routes.push({rule:this.parseRouteRule(e),handler:t,options:r}),this}remove(e){return"string"==typeof e&&(e=this.parseRouteRule(e)),this.routes.some(((t,r)=>(t.handler===e||t.rule===e)&&(this.routes.splice(r,1),!0))),this}async redirectTo(e,t){const r=this.transformURL(e);return history.replaceState(t,null,this.root+r),await this.processUri(),this}async navigateTo(e,t){const r=this.transformURL(e);return history.pushState(t,null,this.root+r),await this.processUri(),this}refresh(){return this.redirectTo(this.fragment+location.search,history.state)}transformURL(e){if("string"!=typeof e)return"";const t=e.trim().split("?");let r="",o="";return 1===t.length?r=t[0]:(r=t[0].trim(),o=t[1].trim()),r?("/"!==this.root&&(r=r.replace(this.root,"")),r=this.trimSlashes(r)):r=this.fragment,o?`${r}?${o}`:r}trimSlashes(e){return"string"!=typeof e?"":e.replace(/\/$/,"").replace(/^\//,"")}parseRouteRule(e){if("string"!=typeof e)return e;let t=this.trimSlashes(e).replace(/([\\\/\-\_\.])/g,"\\$1").replace(/\{[a-zA-Z]+\}/g,"(:any)").replace(/\:any/g,"[\\w\\-\\_\\.]+").replace(/\:word/g,"[a-zA-Z]+").replace(/\:num/g,"\\d+");return new RegExp("^"+t+"$","i")}parseQuery(e){let t={};return"string"!=typeof e||("?"===e[0]&&(e=e.substr(1)),e.split("&").forEach((e=>{let r=e.split("=");""!==r[0]&&(void 0===r[1]&&(r[1]=!0),t[decodeURIComponent(r[0])]=r[1])}))),t}async findRoute(){const e=this.fragment,t=this.query;let r=!1;const o=this.before?.({fragment:e,query:t});if(!o)for(let o of this.routes){const s=e.match(o.rule);if(s){s.shift();const i={fragment:e,query:t,match:s,options:o.options};await(o.handler?.(i)),r=!0;break}}return r}async processUri(){let e=this.fragment;await this.findRoute()||this.page404?.(e)}addUriListener(){window.onpopstate=this.processUri.bind(this)}removeUriListener(){window.onpopstate=null}};const{Router:t}=e;let r=new t({before:e=>!("break"!==e.fragment||!e.query.perform)&&(console.log("Route matching broke"),!0),routes:[{rule:"",handler(e){console.log(e)}},{rule:"hello/(:any)",handler(e){console.log(e)}},{rule:"category/(:num)/post/(:num)",handler(e){console.log(e)}},{rule:"search",handler(e){console.log(e)}},{rule:"break",handler(e){console.log(e)}}]});window.router=r}();
//# sourceMappingURL=router-1.1.3.js.map
